{% extends "base.html" %}
{% block content %}

<style>
  :root{
    --black: #070707;
    --brown-dark: #3e2a1f;
    --brown-mid: #7a5230;
    --brown-light: #d2a679;
    --cream: #f5f5dc;
    --yellow: #FFD24A;
    --transition: all 0.28s cubic-bezier(.2,.9,.3,1);
  }

  body{
    background: linear-gradient(135deg, var(--brown-light) 0%, var(--cream) 100%);
    min-height:100vh;
    margin:0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    color: var(--cream);
  }

  /* STATIC DOT BACKGROUND (NO ANIMATION) */
  body::before{
    content:"";
    position:fixed;
    inset:0;
    background: radial-gradient(circle, rgba(255,255,255,0.08) 10%, transparent 10.5%);
    background-size: 30px 30px;
    z-index:-1;
  }

  .navbar {
    position: fixed !important;
    top: 0; left: 0; right: 0;
    z-index: 9999;
    background: rgba(112, 62, 35, 0.9);
    border-bottom: 2px solid var(--yellow);
  }

  .admin-wrapper {
    padding: calc(140px + 1.5rem) 1rem 4rem;
    display:flex;
    justify-content:center;
    align-items:flex-start;
  }

  .dashboard-card{
    width: min(900px, 100%);
    background: rgba(112, 62, 35, 0.9);
    border-bottom: 2px solid var(--yellow);
    border-radius: 16px;
    padding: 28px;
    box-shadow: 0 20px 40px rgba(15,10,8,0.35);
    backdrop-filter: blur(8px);
  }

  h1{
    margin:0 0 1rem;
    font-size: clamp(1.3rem, 2.5vw, 1.8rem);
    font-weight:800;
    color: var(--yellow);
    text-align:center;
  }

  /* FORM LAYOUT */
  form{
    width:100%;
    max-width: 720px;
    margin-inline:auto;
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 1.2rem 1.5rem;
  }

  .form-label {
    font-weight:600;
    margin-bottom: 4px;
    display:block;
  }

  .form-control,
  .form-select {
    border-radius: 8px;
    padding: 9px 12px;
    border: 2px solid var(--brown-mid);
    background: var(--cream);
    color: var(--black);
    transition: var(--transition);
    width:100%;
    font-size: 0.95rem;
  }

  .form-control:focus,
  .form-select:focus {
    outline:none;
    border-color: var(--yellow);
    box-shadow: 0 0 0 3px rgba(255,210,74,0.25);
  }

  /* FULL WIDTH SECTIONS */
  .full-span {
    grid-column: 1 / -1;
  }

  /* BUTTON */
  .btn-dashboard{
    grid-column: 1 / -1;
    max-width: 320px;
    margin: 1.2rem auto 0;
    padding: 12px;
    border-radius: 10px;
    font-weight:800;
    text-transform:uppercase;
    letter-spacing:0.8px;
    background: linear-gradient(180deg, var(--yellow), #f6c95a);
    color: var(--black);
    border: none;
    cursor:pointer;
    transition: var(--transition);
  }

  .btn-dashboard:hover{
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
  }

  hr{
    margin: 3rem 0 2rem;
    border-color: rgba(255,255,255,0.2);
  }

  @media (max-width: 576px){
    .dashboard-card{ padding: 20px; }
  }
</style>

<div class="admin-wrapper">
  <div class="dashboard-card">

    <h1>Register Users</h1>

    <form method="POST" id="userForm">

      <div>
        <label class="form-label">User ID</label>
        <input type="text" class="form-control" name="user_id" required>
      </div>

      <div>
        <label class="form-label">Name</label>
        <input type="text" class="form-control" name="name" required>
      </div>

      <div>
        <label class="form-label">Email</label>
        <input type="email" class="form-control" name="email" required>
      </div>

      <div>
        <label class="form-label">Password</label>
        <input type="password" class="form-control" name="password" required>
      </div>

      <div class="full-span">
        <label class="form-label">Role</label>
        <select class="form-select" id="role" name="role" required>
          <option value="">-- Select Role --</option>
          <option value="student">Student</option>
          <option value="teacher">Teacher</option>
        </select>
      </div>

      <div id="studentFields" class="full-span" style="display:none">
        <div style="display:grid; gap:1.2rem; grid-template-columns: repeat(auto-fit,minmax(240px,1fr));">

          <div>
            <label class="form-label">Batch</label>
            <select class="form-select" name="batch_id">
              <option value="">-- Select Batch --</option>
              {% for batch in batches %}
              <option value="{{ batch[0] }}">{{ batch[1] }}</option>
              {% endfor %}
            </select>
          </div>

          <div>
            <label class="form-label">Department</label>
            <select class="form-select" name="department_id">
              <option value="">-- Select Department --</option>
              {% for department in departments %}
              <option value="{{ department[0] }}">{{ department[1] }}</option>
              {% endfor %}
            </select>
          </div>

          <div>
            <label class="form-label">Batch Status</label>
            <select class="form-select" id="batch_status" name="batch_status">
              <option value="old">Old</option>
              <option value="new">New</option>
            </select>
          </div>

          <div id="admissionDateField" style="display:none">
            <label class="form-label">Date of Admission</label>
            <input type="date" class="form-control" name="admission_date">
          </div>

        </div>
      </div>

      <button type="submit" class="btn-dashboard">Register User</button>
    </form>

    <hr>

    <h1>Import Users Records</h1>

    <form method="POST" enctype="multipart/form-data" action="{{ url_for('import_users') }}">
      <div class="full-span">
        <label class="form-label">Upload CSV File</label>
        <input type="file" class="form-control" name="csv_file" accept=".csv" required>
      </div>
      <button type="submit" class="btn-dashboard">Import Records</button>
    </form>

  </div>
</div>

<script>
  document.getElementById('role').addEventListener('change', e => {
    document.getElementById('studentFields').style.display =
      e.target.value === 'student' ? 'block' : 'none';
  });

  document.getElementById('batch_status').addEventListener('change', e => {
    document.getElementById('admissionDateField').style.display =
      e.target.value === 'new' ? 'block' : 'none';
  });
</script>

{% endblock %}
